# Containerfile for building WASM-4 projects written in C
# Provides: w4 CLI, wasi-sdk (clang), and necessary build tools

FROM debian:bookworm-slim

# Install dependencies: curl for downloading, make/gcc for builds, nodejs for w4
RUN apt-get update && apt-get install -y \
  curl \
  ca-certificates \
  xz-utils \
  make \
  git \
  nodejs \
  npm \
  python3 \
  && rm -rf /var/lib/apt/lists/*

# Install wasm4 CLI globally via npm
RUN npm install -g wasm4

# Install wasi-sdk (provides clang with wasm32-wasi target)
# This gives you a full C standard library implementation for WASM
ENV WASI_SDK_VERSION=30
ENV WASI_SDK_PATH=/opt/wasi-sdk

RUN curl -L -o /tmp/wasi-sdk.tar.gz \
  https://github.com/WebAssembly/wasi-sdk/releases/download/wasi-sdk-30/wasi-sdk-30.0-x86_64-linux.tar.gz \
  && tar -xzf /tmp/wasi-sdk.tar.gz -C /opt \ 
  && mv /opt/wasi-sdk* ${WASI_SDK_PATH}


# Add wasi-sdk to PATH
ENV PATH="${WASI_SDK_PATH}/bin:${PATH}"

# Set working directory for the project
WORKDIR /project

# By default, show available commands
CMD ["w4", "--help"]
